branches:
    only:
        - 15
        - 16
        - 17
        - 18
        - 19
        - 20
        - 21
        - 22
        - 23
        - 24
        - 25
language: android
jdk: oraclejdk8
addons:
  apt:
    packages:
      - ant
android:
  components:
    - platform-tools
    - android-${TRAVIS_BRANCH}
    - addon-google_apis-google-${TRAVIS_BRANCH}
    - sys-img-armeabi-v7a-google_apis-${TRAVIS_BRANCH}


before_script:
  - nvm install 6
  - echo `which node`
  - android list targets
  - echo no | android create avd --force -n test -t android-${TRAVIS_BRANCH} --abi google_apis/armeabi-v7a
  - emulator -avd test -gpu swiftshader -no-window &


script:
 - wget https://github.com/codenameone/cn1-binaries/archive/master.zip
 - unzip master.zip -d ../
 - mv ../cn1-binaries-master ../cn1-binaries
 - rm master.zip
 - wget https://github.com/codenameone/codenameone-skins/archive/master.zip
 - unzip master.zip -d ../
 - mv ../codenameone-skins-master ../codenameone-skins
 - cd ../codenameone-skins
 - ./build_skins.sh
 - wget https://github.com/codenameone/CodenameOne/archive/master.zip
 - unzip master.zip -d ../
 - mv ../CodenameOne-master ../cn1
 - cd ../cn1
 - cd CodenameOne
 - ant jar
 - cd ../CodenameOneDesigner
 - mkdir dist
 - mkdir dist/lib
 - ant release
 - mkdir ../../codenameone-cli
 - cd ../../codenameone-cli
 - npm install codenameone-cli
 - wget https://github.com/shannah/cn1-unit-tests/archive/master.zip
 - unzip master.zip -d ../
 - mv ../cn1-unit-tests-master ../cn1-unit-tests
 - rm master.zip
 - cd ../cn1-unit-tests
 - android-wait-for-emulator
 - adb shell input keyevent 82 &
 - ../codenameone-cli/node_modules/.bin/cn1 test -cn1Sources ../cn1 -s -e -t android -skipCompileCn1Sources -v
